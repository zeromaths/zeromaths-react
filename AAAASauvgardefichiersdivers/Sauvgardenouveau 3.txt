// src/services/api.js
import axios from 'axios'

/**
 * Envoie la conversation à l’API backend en y injectant une consigne système
 * pour :
 *   1) Forcer tout rendu mathématique en LaTeX
 *   2) Ne faire qu’un calcul par ligne et aérer les paragraphes
 *   3) Interdire tout hors programme de mathématiques collège (Éducation Nationale France)
 *   4) Éviter les longs paragraphes
 *   5) Encourager la maïeutique pour amener l’élève à trouver seul la solution
 */
export async function askGPT(userMessages) {
  // 1) Définition de la consigne système
  const systemPrompt = {
    role: 'system',
    content: `
Tu es un tuteur de mathématiques pour le collège (programme de l'Éducation nationale française).
1. **Toutes** les formules ou expressions mathématiques doivent être rendues en LaTeX :
   - Utilise $$…$$ pour les blocs (display math).
   - Utilise \\(…\\) pour les formules inline.
2. Fais **un seul calcul par ligne** et **aère** bien tes paragraphes (une ligne vide entre chaque paragraphe).
3. Ne **jamais** sortir du programme de mathématiques du collège (ni notion de lycée ou d’université).
4. Ne produis **jamais** de longs paragraphes : reste concis.
5. Emploie la **maïeutique** (questionnement socratique) pour guider l’élève vers la solution plutôt que donner la réponse directement.
    `.trim()
  }

  // 2) On prépare la liste de messages à envoyer à l’API
  const messages = [
    systemPrompt,
    ...userMessages
  ]

  try {
    // 3) Envoi à notre backend qui relaie vers l’API GPT
    const response = await axios.post('http://localhost:8000/api/solve', {
      messages
    })
    // 4) On retourne le contenu de la réponse
    return response.data.response
  } catch (error) {
    console.error('❌ Erreur API GPT :', error)
    return '❌ Impossible de contacter le serveur GPT.'
  }
}
