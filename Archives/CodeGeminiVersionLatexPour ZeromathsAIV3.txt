<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zeromaths.fr - Chatbot Math√©matiques</title>
    <!-- MathJax pour le rendu des formules LaTeX -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],        // D√©finition des d√©limiteurs pour expressions en ligne
                displayMath: [['$$', '$$'], ['\\[', '\\]']]     // D√©limiteurs pour expressions affich√©es (block)
            },
            svg: {
                fontCache: 'global'                                 // Utilisation d‚Äôun cache global pour les polices SVG
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',                  // Classes √† ignorer pour le traitement
                processHtmlClass: 'tex2jax_process'                 // Classes √† traiter
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* ===================== Variables globales & Styles de base ===================== */
        :root {
            --primary-color: #8A2BE2;         /* Couleur principale : violet intense */
            --secondary-color: #5cb85c;       /* Couleur secondaire : vert */
            --tertiary-color: #f0ad4e;        /* Couleur tertiaire : orange */
            --background-light: rgba(255, 255, 255, 0.03); /* Fond clair (tr√®s transparent) pour cartes */
            --background-dark: #000000;       /* Fond principal sombre */
            --text-color: #ffffff;            /* Couleur de texte : blanc */
            --text-muted: #e0e0e0;            /* Texte secondaire/gris√© */
            --border-light: rgba(255, 255, 255, 0.1);     /* Bordures claires */
            --input-bg: rgba(0, 0, 0, 0.1);    /* Fond des champs d‚Äôentr√©e */
            --button-radius: 25px;            /* Rayon de bordure pour boutons */
            --card-radius: 12px;              /* Rayon de bordure pour cartes/messages */
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);  /* Ombre port√©e pour cartes/messages */
            --transition-fast: 0.2s ease;      /* Vitesse de transition rapide */
        }

        * {
            box-sizing: border-box;           /* Inclusion du padding/border dans la largeur/hauteur */
        }

        body {
            display: flex;
            flex-direction: column;           /* Disposition verticale */
            align-items: center;              /* Centrer horizontalement */
            margin: 0;
            padding: 20px;
            min-height: 100vh;                /* Au moins la hauteur de la fen√™tre */
            background-color: var(--background-dark); /* Fond sombre */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Police moderne */
            color: var(--text-color);         /* Texte blanc */
            line-height: 1.6;
        }

        /* Style pour le titre principal avec un d√©grad√© et d√©coupe de texte */
        h1.gradient-text {
            font-size: 3.5rem;
            font-weight: bold;
            background: linear-gradient(to right, #0000CD, #00008B, #4B0082, #8A2BE2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2),
                         1px 1px 3px rgba(0, 0, 0, 0.5);
            text-align: center;
            margin-bottom: 20px;
        }

        /* ===================== Conteneur du chat ===================== */
        .chat-container {
            width: 100%;
            max-width: 700px;                         /* Limite la largeur √† 700px */
            background-color: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: var(--card-radius);
            box-shadow: var(--card-shadow);
            padding: 15px;
            display: flex;
            flex-direction: column;                   /* Messages empil√©s verticalement */
            max-height: 80vh;                         /* Max hauteur : 80% de la fen√™tre */
            overflow-y: auto;                         /* Scroll si overflow vertical */
        }

        /* ===================== Bulles de message ===================== */
        .message {
            max-width: 80%;                            /* Ne pas d√©passer 80% de la largeur */
            margin-bottom: 10px;
            padding: 10px 15px;
            border-radius: var(--card-radius);
            position: relative;
            opacity: 0;                                /* Initialement invisible */
            transform: translateY(10px);               /* L√©g√®rement d√©cal√© vers le bas */
            transition: opacity 0.3s, transform 0.3s;   /* Transition pour fade-in et slide-up */
        }

        /* Quand la classe "visible" est ajout√©e, la bulle appara√Æt */
        .message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Styles sp√©cifiques pour les bulles du bot */
        .bot {
            align-self: flex-start;                   /* Align√© √† gauche */
            background-color: var(--primary-color);
            color: var(--text-color);
            border-top-left-radius: 2px;
            border-bottom-left-radius: var(--card-radius);
        }

        /* Styles pour les bulles de l‚Äôutilisateur */
        .user {
            align-self: flex-end;                     /* Align√© √† droite */
            background-color: var(--secondary-color);
            color: var(--text-color);
            border-top-right-radius: 2px;
            border-bottom-right-radius: var(--card-radius);
        }

        /* Indicateur de "typing" (bot en train d‚Äô√©crire) */
        .typing-indicator {
            font-style: italic;
            color: var(--text-muted);
        }

        /* ===================== Quick Replies (boutons d‚Äôaction rapide) ===================== */
        .quick-replies {
            display: flex;
            flex-wrap: wrap;                            /* Les boutons passent √† la ligne si n√©cessaire */
            gap: 10px;
            margin: 10px 0;
            opacity: 0;                                /* Cach√© initialement */
            transform: translateY(10px);
            transition: opacity 0.2s, transform 0.2s;    /* Animation d‚Äôapparition */
        }

        /* Lorsque visible, afficher les quick replies */
        .quick-replies.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Style des boutons quick replies */
        .quick-reply-button {
            background-color: var(--tertiary-color);
            color: var(--text-color);
            border: none;
            border-radius: var(--button-radius);
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color var(--transition-fast), transform 0.1s ease;
        }

        .quick-reply-button:hover {
            opacity: 0.9;                               /* Retour visuel au survol */
        }

        .quick-reply-button:active {
            transform: scale(0.96);                     /* Effet "clic" */
        }

        /* ===================== Section de saisie utilisateur ===================== */
        .input-section {
            width: 100%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            margin-top: 10px;
        }

        /* Champ de saisie de texte */
        .input-field {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color var(--transition-fast);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 5px rgba(138, 43, 226, 0.4);
        }

        /* Bouton d‚Äôenvoi */
        .send-button {
            align-self: flex-end;                       /* Align√© √† droite */
            padding: 10px 20px;
            font-size: 1rem;
            color: var(--text-color);
            background-color: var(--primary-color);
            border: none;
            border-radius: var(--button-radius);
            cursor: pointer;
            transition: background-color var(--transition-fast), transform 0.1s ease;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }

        .send-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .send-button:hover:not(:disabled) {
            opacity: 0.9;
        }

        .send-button:active:not(:disabled) {
            transform: scale(0.96);
        }

        /* ===================== Styles Responsive ===================== */
        @media (max-width: 700px) {
            h1.gradient-text { font-size: 2.8rem; }
            .chat-container { padding: 10px; }
            .message { font-size: 0.9rem; }
            .input-field { font-size: 0.9rem; padding: 10px; }
            .send-button { font-size: 0.9rem; padding: 8px 16px; }
        }
    </style>
</head>

<body>
    <!-- Titre principal avec effet d√©grad√© -->
    <h1 class="gradient-text">Zeromaths.fr Chatbot</h1>

    <!-- Conteneur principal du chat o√π seront inject√©s les messages -->
    <div class="chat-container" id="chatContainer">
        <!-- Exemples :
            <div class="message bot">Bienvenue !</div>
            <div class="message user">Bonjour</div>
        -->
    </div>

    <!-- Quick Replies : zone o√π s‚Äôaffichent les boutons contextuels -->
    <div class="quick-replies" id="quickReplies" aria-live="polite"></div>

    <!-- Section pour saisir le texte utilisateur -->
    <div class="input-section">
        <!-- Champ de saisie -->
        <input type="text" id="userInput" class="input-field" placeholder="Posez votre question..." aria-label="Entr√©e utilisateur">
        <!-- Bouton Envoyer (d√©sactiv√© si aucun texte dans le champ) -->
        <button id="sendBtn" class="send-button" disabled>Envoyer</button>
    </div>

    <!-- ===================== Script JavaScript ===================== -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const chatContainer = document.getElementById('chatContainer');
            const userInput = document.getElementById('userInput');
            const sendBtn = document.getElementById('sendBtn');
            const quickReplies = document.getElementById('quickReplies');

            // R√©cup√®re le pr√©nom de l‚Äôutilisateur dans le localStorage ou le demande via prompt
            let userFirstName = localStorage.getItem('zeromathsUserFirstName');
            if (!userFirstName) {
                userFirstName = prompt("Quel est votre pr√©nom ?");
                if (!userFirstName) userFirstName = 'Ami(e) de Zeromaths';  // Valeur par d√©faut si rien n‚Äôest saisi
                localStorage.setItem('zeromathsUserFirstName', userFirstName);
            }

            /* ===================== Fonctions utilitaires ===================== */

            // Renvoie "Bonjour", "Bon apr√®s-midi" ou "Bonsoir" en fonction de l‚Äôheure √† Paris
            function getGreeting() {
                const now = new Date().toLocaleString('fr-FR', { timeZone: 'Europe/Paris' });
                const hour = new Date(now).getHours();
                if (hour < 12) return 'Bonjour';
                else if (hour < 18) return 'Bon apr√®s-midi';
                else return 'Bonsoir';
            }

            // Tableau de phrases humoristiques pour varier la salutation
            const humorLines = [
                "J'esp√®re que votre caf√© est chaud, on va faire chauffer les neurones !",
                "Les int√©grales attendent, mais pas avant vous ! üòÑ",
                "Vous √™tes pr√™t √† dompter la g√©om√©trie aujourd'hui ?"
            ];

            // S√©lectionne al√©atoirement une phrase humoristique (50% de chance d‚Äôen avoir une)
            function getRandomHumor() {
                if (Math.random() < 0.5) {
                    return humorLines[Math.floor(Math.random() * humorLines.length)];
                }
                return '';
            }

            // Appelle l‚ÄôAPI m√©t√©o pour Paris et renvoie une phrase contextualis√©e (optionnel)
            async function fetchWeather() {
                try {
                    const apiKey = 'VOTRE_API_KEY'; // √Ä remplacer par votre cl√© OpenWeatherMap
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?q=Paris&units=metric&lang=fr&appid=${apiKey}`
                    );
                    if (!response.ok) return '';
                    const data = await response.json();
                    return `Avec ce temps ${data.weather[0].description} √† Paris, rien de mieux qu‚Äôun d√©fi d‚Äôalg√®bre !`;
                } catch {
                    return '';
                }
            }

            // Cr√©e une bulle de message (bot ou user) et l‚Äôajoute au chat
            function createBubble(text, sender = 'bot') {
                const bubble = document.createElement('div');
                bubble.className = `message ${sender}`;      // Ajoute classe "message" et "bot" ou "user"
                bubble.setAttribute('aria-live', 'polite');  // Pour lecteur d‚Äô√©cran
                bubble.textContent = text;
                chatContainer.appendChild(bubble);
                // Force reflow, puis on ajoute la classe visible pour l‚Äôanimation
                requestAnimationFrame(() => {
                    bubble.classList.add('visible');
                });
                // Scroll automatique vers le bas
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return bubble;
            }

            // Affiche le texte caract√®re par caract√®re (effet "machine √† √©crire")
            async function typeMessage(element, text) {
                element.textContent = '';
                for (const char of text) {
                    element.textContent += char;
                    await new Promise(r => setTimeout(r, 30));      // D√©lai de 30ms entre chaque caract√®re
                }
            }

            /* ===================== Affichage de l‚Äôaccueil personnalis√© ===================== */
            (async () => {
                // Affiche un indicateur de "typing" (trois points)
                const typingBubble = document.createElement('div');
                typingBubble.className = 'message bot typing-indicator';
                typingBubble.textContent = '‚Ä¶';
                chatContainer.appendChild(typingBubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Pr√©pare le texte de bienvenue
                const greeting = getGreeting();                  // "Bonjour" / "Bon apr√®s-midi" / "Bonsoir"
                const humor = getRandomHumor();                  // Phrase humoristique ou cha√Æne vide
                const weatherPart = await fetchWeather();        // Phrase m√©t√©o ou cha√Æne vide
                let welcomeText = `${greeting} ${userFirstName} ! Pr√™t pour de nouvelles d√©couvertes math√©matiques aujourd'hui ?`;
                if (humor) welcomeText += ` ${humor}`;            // Ajoute l‚Äôhumour si non vide
                if (weatherPart) welcomeText += ` ${weatherPart}`; // Ajoute la m√©t√©o si non vide

                // Retire l‚Äôindicateur de "typing"
                chatContainer.removeChild(typingBubble);

                // Cr√©e la bulle bot vide pour y taper le texte
                const bubble = document.createElement('div');
                bubble.className = 'message bot';
                bubble.setAttribute('aria-live', 'polite');
                chatContainer.appendChild(bubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                // Effet "machine √† √©crire" puis apparition
                await typeMessage(bubble, welcomeText);
                bubble.classList.add('visible');
            })();

            /* ===================== Activation du bouton Envoyer ===================== */
            userInput.addEventListener('input', () => {
                // Active ou d√©sactive le bouton en fonction du contenu du champ
                sendBtn.disabled = userInput.value.trim() === '';
            });

            /* ===================== Gestion du clic sur "Envoyer" ===================== */
            sendBtn.addEventListener('click', async () => {
                const text = userInput.value.trim();
                if (!text) return;

                // Affiche le message de l‚Äôutilisateur
                createBubble(text, 'user');
                userInput.value = '';
                sendBtn.disabled = true;

                // R√©initialise les quick replies (si affich√©es)
                quickReplies.innerHTML = '';
                quickReplies.classList.remove('visible');

                // Affiche indicateur de "typing" pour la r√©ponse du bot
                const typingBubble = document.createElement('div');
                typingBubble.className = 'message bot typing-indicator';
                typingBubble.textContent = '‚Ä¶';
                chatContainer.appendChild(typingBubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Simule un appel API (1 seconde de latence)
                await new Promise(r => setTimeout(r, 1000));
                const botResponse = `Voici une r√©ponse simul√©e pour : "${text}"`;

                // Retire l‚Äôindicateur et affiche la r√©ponse du bot
                chatContainer.removeChild(typingBubble);
                const responseBubble = createBubble('', 'bot');
                await typeMessage(responseBubble, botResponse);
                responseBubble.classList.add('visible');

                // Affiche les quick replies contextuels
                const replies = [
                    { label: 'üí° Voir un exemple', action: 'voir_exemple' },
                    { label: 'üìù G√©n√©rer un probl√®me', action: 'generer_probleme' },
                    { label: 'üîô Revenir en arri√®re', action: 'revenir_arriere' }
                ];
                replies.forEach(rep => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-reply-button';
                    btn.textContent = rep.label;
                    btn.setAttribute('data-action', rep.action);
                    btn.addEventListener('click', () => handleQuickReply(rep.action));
                    quickReplies.appendChild(btn);
                });
                quickReplies.classList.add('visible');
            });

            /* ===================== Gestion des Quick Replies ===================== */
            async function handleQuickReply(action) {
                // Supprime les quick replies existantes
                quickReplies.innerHTML = '';
                quickReplies.classList.remove('visible');

                let promptText;
                switch (action) {
                    case 'voir_exemple':
                        promptText = 'Donne-moi un exemple concret.';
                        break;
                    case 'generer_probleme':
                        promptText = 'G√©n√®re un probl√®me.';
                        break;
                    case 'revenir_arriere':
                        promptText = 'Reviens √† la question pr√©c√©dente.';
                        break;
                    default:
                        promptText = '';
                }
                if (!promptText) return;

                // Affiche la requ√™te rapide de l‚Äôutilisateur
                createBubble(promptText, 'user');

                // Affiche indicateur de "typing"
                const typingBubble = document.createElement('div');
                typingBubble.className = 'message bot typing-indicator';
                typingBubble.textContent = '‚Ä¶';
                chatContainer.appendChild(typingBubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Simule un appel API
                await new Promise(r => setTimeout(r, 1000));
                const botResponse = `R√©ponse √† la quick reply: "${promptText}"`;

                // Affiche la r√©ponse
                chatContainer.removeChild(typingBubble);
                const responseBubble = createBubble('', 'bot');
                await typeMessage(responseBubble, botResponse);
                responseBubble.classList.add('visible');
            }
        });
    </script>
</body>

</html>
